(function(e,t,n,r){function o(t,n){this.element=t;this.options=e.extend({},s,n);this._defaults=s;this._name=i;this.init()}var i="uwDynamicFilters",s={activeFilters:[],addBtnSelector:".uw-dynamic-filters-btn-dialog-open",containerSelector:".uw-dynamic-filters-container",dialogSelector:".uw-dynamic-filters-dialog",viewSelector:'script[type="text/html"]',viewListClass:"uw-dynamic-filters-filter-list",viewListItemClass:"uw-dynamic-filters-filter-list-item",viewListNoneClass:"uw-dynamic-filters-filter-none",dialogSettings:{},viewListTag:"ul",viewListItemTag:"li",viewListNoneTag:"div",filterCallbacks:{}};o.prototype={init:function(){var t=this,n=e(this.options.dialogSelector),r=function(t){return e("<"+t+">")};try{var i=this.getViews(),s=r(this.getViewListTag()).addClass(this.options.viewListClass),o=r(t.options.viewListNoneTag).addClass(t.options.viewListNoneClass).text("Nincs megjeleníthető szűrő!").hide();n.html(s);o.appendTo(n);e.each(i,function(n,i){var o=e(i),u=i.dataset,f=r(t.getViewListItemTag()),l=a(u.uwDynamicFilterView,t);f.addClass(t.options.viewListItemClass).text(u.uwDynamicFilterName).appendTo(s);l.appendTo(f);if(h(o)){if(t.isActive(u.uwDynamicFilterItem)){l.trigger("click")}}});e(this.element).find("input").live("keypress",function(t){if(t.which==13){t.preventDefault();e(this).closest("form").submit()}})}catch(u){console.error(u)}e(this.options.addBtnSelector).button({create:function(t,r){e(t.target).bind("click",function(){n.dialog("open")})},icons:{primary:"ui-icon-plusthick"}});e(this.options.dialogSelector).dialog(this.options.dialogSettings)},getContainer:function(){return e(this.element).find(this.options.containerSelector)},getDialog:function(){return e(this.options.dialogSelector)},getViewListTag:function(){return this.options.viewListTag},getViewListItemTag:function(){return this.options.viewListItemTag},getViews:function(){return e(this.element).find(this.options.viewSelector)},isActive:function(e){return this.options.activeFilters.indexOf(e)<0?false:true},showHideFilterBtn:function(e,t){if(e!==r&&(t==="show"||t==="hide")){var n=this.getDialog().find("."+this.options.viewListClass).find("."+this.options.viewListItemClass).find('button[data-uw-dynamic-filter-view="'+e+'"]').parent(),i=this.getDialog().find("."+this.options.viewListNoneClass);if(t==="show"){i.hide();n.show()}else{n.hide();if(this.getDialog().find("."+this.options.viewListItemClass+":visible").length==0){i.show()}}}else{throw"A nézet megadása kötelező, valamint az action paraméter értéke csak show vagy hide lehet!"}},showFilterBtn:function(e){this.showHideFilterBtn(e,"show")},hideFilterBtn:function(e){this.showHideFilterBtn(e,"hide")}};var u=function(t,n){var r=e("<button>");e.each(t,function(e,t){r.attr(e,t)});r.attr("type","button");if(n instanceof Object){r.button(n)}return r};var a=function(t,n){return u({"class":"uw-dynamic-filters-btn-add","data-uw-dynamic-filter-view":t},{create:function(t,r){e(t.target).click(function(){var t=this.dataset.uwDynamicFilterView,r=e(n.element).find(n.options.viewSelector+'[data-uw-dynamic-filter-view="'+t+'"]');c(n,r);n.hideFilterBtn(t)})},icons:{primary:"ui-icon-plusthick"},text:false})};var f=function(t,n){return u({"class":"uw-dynamic-filters-btn-remove","data-uw-dynamic-filter-view":t},{create:function(t,r){e(t.target).click(function(){var e=this.dataset.uwDynamicFilterView,t=n.getContainer().find("#"+e);if(t.length===1){l(n,e,"beforeRemove",t);t.remove();n.showFilterBtn(e);l(n,e,"afterRemove",t)}})},icons:{primary:"ui-icon-minusthick"},text:false})};var l=function(t,n,i,s){if(t.options.filterCallbacks[n]!==r&&e.isFunction(t.options.filterCallbacks[n][i])){if(s===r){t.options.filterCallbacks[n][i].call(this)}else{t.options.filterCallbacks[n][i].call(this,s)}}};var c=function(t,n){var r=e(n.get(0).outerText),i=n.data("uw-dynamic-filter-view"),s=f(i,t);r.attr("id",i);l(t,i,"beforeAdd");s.appendTo(r);l(t,i,"initialize",r);r.appendTo(t.getContainer());l(t,i,"afterAdd",r)};var h=function(e){var t=e.data(),n=function(e,t){if(e===r||e.length<2){throw"A nézet "+t+" attribútuma hiányzik, vagy nem megfelelő!"}else{return true}};return n(t["uw-dynamic-filter-view"],"data-uw-dynamic-filter-view")&&n(t["uw-dynamic-filter-name"],"data-uw-dynamic-filter-name")&&n(t["uw-dynamic-filter-item"],"data-uw-dynamic-filter-item")};e.fn[i]=function(t){this.each(function(){if(!e.data(this,"plugin_"+i)){e.data(this,"plugin_"+i,new o(this,t))}});return this}})(jQuery,window,document)